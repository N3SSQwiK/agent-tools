description = "Execute approved orchestration plan or specific task"
prompt = """
You are executing the /maestro run command.

Your Goal: Execute approved Maestro orchestration plan or a specific task.

## User Input
{{args}}

## Behavior

1. Load plan from `.ai/MAESTRO.md`
   - If not exists: "No active plan. Run `/maestro plan <goal>` first."

2. If task ID provided (`/maestro run 3`), target that task
   - Otherwise, find next runnable task(s) (status=pending, dependencies satisfied)

3. For each runnable task:
   a. Perform pre-delegation reconnaissance (cheap checks)
   b. Validate preconditions (AAVSR)
   c. Build task handoff using Spoke Contract template
   d. Dispatch to assigned tool
   e. Collect and normalize result
   f. Validate result against quality gates
   g. Update state file
   h. Log execution (if logging enabled)

4. Continue until:
   - All tasks complete
   - Task fails (after retry ladder exhausted)
   - User intervention required

## Task Handoff Template

Send to spoke:
```markdown
## Task
[Clear, atomic task description]

## Context
[Relevant files using @path syntax, decisions, constraints]

## Success Criteria
- [ ] [Criterion 1]
- [ ] [Criterion 2]

## Constraints
- [Scope boundary]

## Output Format
Return result as markdown with Status, Summary, Changes, Verification, Issues sections.
```

## CLI Dispatch Patterns

### Gemini CLI (self)
Use @path/to/file for file references (9.2x token efficiency).

### Codex CLI
```bash
codex exec "<handoff prompt>" --full-auto --json
```

### Claude Code
Claude Code runs interactively. Provide handoff via direct prompt.

## Precondition Checks (AAVSR)
- **Atomic:** Single responsibility, one clear outcome?
- **Authority:** Specialist has capability?
- **Verifiable:** Success criteria testable?
- **Scope:** Fits within boundaries?
- **Risk:** Acceptable failure impact?

## Retry Ladder

On task failure:
1. **Immediate Retry** - Transient failures (network, timeout with complete output)
2. **Context Expansion** - Add more context, retry
3. **Task Decomposition** - Break into smaller subtasks
4. **User Escalation** - Present options to user

## Token Budgets
- Gemini CLI: 30,000 (abort at 50,000)
- Codex CLI: 40,000 (abort at 60,000)

## Rules
- Always perform reconnaissance before dispatch
- Validate AAVSR before every dispatch
- Never skip quality gates
- Update state file after each task
- Use UTC timestamps
- Hub tool name is "Gemini CLI"

## Flags
- `--log=summary`: Log actions and outcomes
- `--log=detailed`: Log full prompts and outputs
- `--dry-run`: Show what would execute without dispatching
"""
